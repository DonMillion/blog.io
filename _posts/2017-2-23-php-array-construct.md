---
layout: post
title: php数组的内部结构简介
date: 2017-2-22
categories: blog
tags: [php原理, php]
description: php数组的内部结构。
---

## php数组的结构 ##

php的数组内部结构是通过键值的哈希值寻找对应的槽位，每个槽位指向一个双向链表。

双向链表里的每一个元素都有对应的key值和上一个跟下一个元素的地址。找到槽位后，系统会沿着链表逐个匹配key值，如果相等则取之，找不到则返回null.这是php数组在寻位时的基本过程。

一般情况下php的哈希算法可以良好地讲key进行均匀的分布，由于php的哈希算法是公开的，所以可以刻意制造出大量相同槽位的key，这样的话，哈希表就会倒退为一个单链表，造成性能急剧下降，可以参考作为一种DDOS攻击。对于这种攻击，一种治标不治本的预防方式是[在php配置文件php.ini里说明限制用户的提交字段的数量](http://cn2.php.net/manual/en/info.configuration.php#ini.max-input-vars),但是现在基本都会用json给接口传输数据，这种攻击方式更容易出现在执行json_decode时出现。

每个元素都有一个指针指向下一个元素的地址，foreach语句这样在遍历的时候就利用了这个特点，遍历数组时速度比直接指明key值要快，因为前者不用重新计算元素地址。